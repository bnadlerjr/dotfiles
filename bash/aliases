# Enable alias expansion
shopt -s expand_aliases

# Bash
alias reload="source ~/dotfiles/bash/aliases"
alias ea="vim ~/dotfiles/bash/aliases && reload"
alias l="ls -lgohG"
alias la="ls -AlgohG"
alias ..="cd .."
alias cdd="cd -"
alias df="df -h"
alias t="tree -C -I 'bower_components|coverage|target|node_modules|venv|*.pyc'"
alias dtstr="date +%Y%m%d%H%M%S"
alias terminal-notifier="reattach-to-user-namespace terminal-notifier"

# Run Emacs.app
alias emacs="/Applications/Emacs.app/Contents/MacOS/Emacs $@"

# Use Homebrew installed Vim
alias vim="/usr/local/Cellar/vim/8.0.1650_1/bin/vim"

# Create directory, then enter it
mkcd () {
    mkdir -p "$*"
    cd "$*"
}

# Kill a process from a pid file
function pk {
    kill -9 $(cat $1)
}

# top 5 one-word commands (and total number)
function topcmd() {
    history | \
    awk "{a[\$2]++}END{print NR, \"((TOTAL))\"; for(i in a) print a[i], i}" | \
    sort -rn | \
    head -6
}

# top 5 two-word commands
function top2cmd(){
    history | \
    awk "/$1/{a[\$2 \" \" \$3]++}END{for(i in a) print a[i], i}" | \
    sort -rn | \
    head -5
}

# Python
alias rmpyc="find . -name '*.pyc' -delete"

# Ruby
alias r="time bundle exec rake"
alias gemi="gem install --no-rdoc"
alias gemlr="gem list --remote"

alias mm="middleman"

# Bundler
alias be="bundle exec"
alias bi="bundle install"
alias bib="bundle install --binstubs"

# Git
function g() {
    git ${*:-status}
}

# OSX firewall UI doesn't add MOSH correctly for some reason. Add it via the
# firewall CLI instead.
function add_mosh_to_firewall {
    local fw='/usr/libexec/ApplicationFirewall/socketfilterfw'
    local mosh_sym="$(which mosh-server)"
    local mosh_abs="$(greadlink -f $mosh_sym)"
    sudo "$fw" --setglobalstate off
    sudo "$fw" --add "$mosh_sym"
    sudo "$fw" --unblockapp "$mosh_sym"
    sudo "$fw" --add "$mosh_abs"
    sudo "$fw" --unblockapp "$mosh_abs"
    sudo "$fw" --setglobalstate on
}
